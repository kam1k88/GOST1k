import os
import time
import statistics
import asyncio
import json
from datetime import datetime
from rag_main import answer
from evaluate_crag_metrics import compute_crag_metrics

# === –ü—É—Ç–∏ ===
BASE = os.path.dirname(os.path.abspath(__file__))
LOGS = os.path.join(BASE, "logs")
os.makedirs(LOGS, exist_ok=True)

# === –°–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ (100 —à—Ç—É–∫) ===
QUERIES = [
    "–ö–∞–∫–∏–µ —Ü–µ–ª–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ì–û–°–¢ –† 57580 –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∑–∞—â–∏—Ç—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è—Ö?",
    "–ß—Ç–æ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –ì–û–°–¢ –† 56939 –≤ –æ–±–ª–∞—Å—Ç–∏ –∞—É–¥–∏—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏?",
    "–ö–∞–∫–∏–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —ç—Ç–∞–ø—ã –≤–∫–ª—é—á–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–æ –ø—Ä–∏–∫–∞–∑—É –§–°–¢–≠–ö ‚Ññ235?",
    "–ö–∞–∫–∏–µ —Ç–∏–ø—ã —É–≥—Ä–æ–∑ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è –≤ –ì–û–°–¢ –† 52447-2005?",
    "–ß—Ç–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ì–û–°–¢ –† 52448-2005 –≤ —á–∞—Å—Ç–∏ –º–æ–¥–µ–ª–µ–π –Ω–∞—Ä—É—à–∏—Ç–µ–ª—è?",
    "–ö–∞–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —É –∫–æ–º–ø–ª–µ–∫—Å–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤ –ì–û–°–¢ –† 52633?",
    "–ß—Ç–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ì–û–°–¢ –† 52633.3-2011 –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ —Å—Ä–µ–¥—Å—Ç–≤–∞–º –∑–∞—â–∏—Ç—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏?",
    "–ö–∞–∫–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ –ì–û–°–¢ –† 59453.1-2021?",
      "–ß–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –ì–û–°–¢ –† 56938-2016 –æ—Ç –ì–û–°–¢ –† 56939-2016?",
      "–ß—Ç–æ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –ì–û–°–¢ –† 56545-2015 –≤ —á–∞—Å—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –∑–∞—â–∏—â–µ–Ω–Ω–æ—Å—Ç–∏?",
    "–ö–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –∑–∞—â–∏—Ç—ã ¬´–ë–ò¬ª –≤ –ì–û–°–¢ –† 52633.6-2012?",
    "–ö–∞–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –ì–û–°–¢ –† 56103-2014 –¥–ª—è —Å—Ä–µ–¥—Å—Ç–≤ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π –∑–∞—â–∏—Ç—ã?",
    "–ö–∞–∫–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ì–û–°–¢ –† 53113.1-2008 –ø–æ –æ–±—â–∏–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–º –ò–ë?",
    "–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –ì–û–°–¢ –† 53111-2008 ¬´–ú–µ–Ω–µ–¥–∂–º–µ–Ω—Ç —Å–µ—Ç–µ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏¬ª?",
    "–ö–∞–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ã —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –ì–û–°–¢ –† 53109-2008 –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Å–µ—Ç–µ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏?",
    "–ö–∞–∫–∏–µ –º–µ—Ä—ã –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –¥–æ—Å—Ç—É–ø–æ–º —Å–æ–¥–µ—Ä–∂–∏—Ç –ì–û–°–¢ –† 57580?",
    "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¢–ö 362 —Ä–µ–≥—É–ª–∏—Ä—É—é—Ç –ø—Ä–æ—Ü–µ—Å—Å—ã –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∑–∞—Ü–∏–∏?",
    "–ß—Ç–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ì–û–°–¢ –† 59547-2021 –ø—Ä–∏ –∫–æ–Ω—Ç—Ä–æ–ª–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å—Ä–µ–¥—Å—Ç–≤ –∑–∞—â–∏—Ç—ã?",
    "–ö–∞–∫–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è –≤–∫–ª—é—á–∞–µ—Ç –ì–û–°–¢ –† 58833-2020 –≤ —á–∞—Å—Ç–∏ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤?",
    "–ß—Ç–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ì–û–°–¢ –† 58256-2018 –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –∫–ª—é—á–∞–º–∏?",
    "–ö–∞–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø—Ä–µ–¥—ä—è–≤–ª—è—é—Ç—Å—è –∫ –∞—É–¥–∏—Ç—É –ò–ë –ø–æ –ì–û–°–¢ –† 58142-2018?",
    "–ö–∞–∫–∏–µ –º–µ—Ç–æ–¥–∏–∫–∏ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ì–û–°–¢ –† 58143-2018 –¥–ª—è Common Criteria?",
    "–ß—Ç–æ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –ì–û–°–¢ –† 59548-2022 –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ –°–ö–ó–ò?",
    "–ö–∞–∫–∏–µ –∑–∞–¥–∞—á–∏ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ì–û–°–¢ –† 59709-2022 –¥–ª—è –ê–°–£ –¢–ü?",
    "–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –ì–û–°–¢ –† 59711-2022 –≤ —á–∞—Å—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏?",
    "–ö–∞–∫–∏–µ –∫–ª—é—á–µ–≤—ã–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –ì–û–°–¢ –† 27001-2021 –ø–æ ISMS?",
    "–ö–∞–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–∞—ë—Ç –ì–û–°–¢ –† 27005-2010 –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Ä–∏—Å–∫–∞–º–∏?",
    "–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ì–û–°–¢ –† 53112-2008 –≤ –æ–±–ª–∞—Å—Ç–∏ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π –∑–∞—â–∏—Ç—ã?",
    "–ß—Ç–æ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –ì–û–°–¢ –† 52633.4-2011 –ø–æ –æ—Ü–µ–Ω–∫–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –°–ó–ò?",
    "–ö–∞–∫–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –ì–û–°–¢ –† 54581-2011 –æ –¥–æ–≤–µ—Ä–∏–∏ –∫ –ò–¢-–ø—Ä–æ–¥—É–∫—Ç–∞–º?",
    "–ß–µ–º —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è –ì–û–°–¢ –† 54582-2011 –∏ –ì–û–°–¢ –† 54583-2011?",
    "–ß—Ç–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ì–û–°–¢ –† 56093-2014 –≤ —á–∞—Å—Ç–∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å—Ä–µ–¥—Å—Ç–≤ –∑–∞—â–∏—Ç—ã?",
    "–ö–∞–∫–∏–µ —Ü–µ–ª–∏ —É –ì–û–°–¢ –† 56115-2014 –≤ –∏—Å–ø—ã—Ç–∞–Ω–∏—è—Ö –°–ö–ó–ò?",
    "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∏—Ä—É—é—Ç –∞—É–¥–∏—Ç –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º ISO/IEC 27001 –∏ 27005?",
    "–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –ì–û–°–¢ –† 51583-2014 –ø–æ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å—Ä–µ–¥—Å—Ç–≤ –∑–∞—â–∏—Ç—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏?",
    "–ö–∞–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –ì–û–°–¢ –† 51275-2006 –≤ —á–∞—Å—Ç–∏ —Ç–µ—Ä–º–∏–Ω–æ–≤ –ø–æ –∑–∞—â–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏?",
    "–ß—Ç–æ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –ì–û–°–¢ –† 52069.0-2013 –≤ –æ–±–ª–∞—Å—Ç–∏ –æ–±—â–∏—Ö –ø–æ–ª–æ–∂–µ–Ω–∏–π –ø–æ –ò–ë?",
    "–ö–∞–∫–∏–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è –æ–ø–∏—Å–∞–Ω—ã –≤ –ì–û–°–¢ –† 52633.1-2009?",
    "–ß—Ç–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ì–û–°–¢ –† 52633.2-2010 –≤ —á–∞—Å—Ç–∏ –º–µ—Ç–æ–¥–æ–≤ –∏—Å–ø—ã—Ç–∞–Ω–∏–π?",
    "–ö–∞–∫–∏–µ –∫–ª—é—á–µ–≤—ã–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –ì–û–°–¢ –† 52633.5-2011 –ø–æ –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤?",
    "–ö–∞–∫–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –∑–∞–ª–æ–∂–µ–Ω—ã –≤ –ì–û–°–¢ –† 56938-2016 –ø–æ –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç—É –ò–ë?",
    "–ö–∞–∫–æ–≤–∞ —Ü–µ–ª—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ –ì–û–°–¢ –† 57628-2017 –ø–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π?",
    "–ß—Ç–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ì–û–°–¢ –† 59453.3-2025 –ø–æ –æ—Ü–µ–Ω–∫–µ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π?",
    "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Ä–µ–≥—É–ª–∏—Ä—É—é—Ç –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤ –ì–û–°–¢ –† 70262.1-2022?",
    "–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –ì–û–°–¢ –† 53131-2008 –ø–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é –ø–æ—Å–ª–µ –ß–°?",
    "–ö–∞–∫–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ê–°–£ –¢–ü –æ–ø–∏—Å–∞–Ω—ã –≤ –ì–û–°–¢ –† 59712-2022?",
    "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¢–ö 362 —Ä–µ–≥—É–ª–∏—Ä—É—é—Ç –ø—Ä–æ—Ü–µ—Å—Å—ã –¥–æ–≤–µ—Ä–∏—è –∫ –ò–¢-–ø—Ä–æ–¥—É–∫—Ç–∞–º?",
    "–ß—Ç–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ì–û–°–¢ –† 58142-2018 –¥–ª—è Common Criteria?",
    "–ö–∞–∫–∏–µ –ø–æ–¥—Ö–æ–¥—ã –∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –°–ó–ò —É–∫–∞–∑–∞–Ω—ã –≤ –ì–û–°–¢ –† 59547-2021?",
    "–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –ì–û–°–¢ –† 27033-1-2011 –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å–µ—Ç–µ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏?",
    "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –º–æ–¥–µ–ª—å —É–≥—Ä–æ–∑ –ø–æ –¢–ö 362?",
    "–ß—Ç–æ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –ì–û–°–¢ –† 50.1.056-2005?",
    "–ö–∞–∫–∏–µ –º–µ—Ç–æ–¥—ã –∏—Å–ø—ã—Ç–∞–Ω–∏–π –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ –ì–û–°–¢ –† 52633.2-2010?",
    "–ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —É—Ä–æ–≤–µ–Ω—å –¥–æ–≤–µ—Ä–∏—è –ò–¢-–ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ –ì–û–°–¢ –† 54581?",
    "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∏—Ä—É—é—Ç –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç –ò–ë –ø–æ ISO/IEC 27001?",
    "–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∞—É–¥–∏—Ç–∞ –ø–æ –ì–û–°–¢ –† 56939?",
    "–ö–∞–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∑–∞—â–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ—Ç –ù–°–î —É–∫–∞–∑–∞–Ω—ã –≤ –ì–û–°–¢ 50739-95?",
    "–ß—Ç–æ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –ì–û–°–¢ –† 50922-2006 –≤ —á–∞—Å—Ç–∏ —Ç–µ—Ä–º–∏–Ω–æ–≤ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π?",
    "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ–ø–∏—Å—ã–≤–∞—é—Ç –ø–æ–ª–∏—Ç–∏–∫—É —Å–µ—Ç–µ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–æ –ì–û–°–¢ –† 53114?",
    "–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –ì–û–°–¢ –† 53115-2008 –ø–æ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞–º —Å–µ—Ç–µ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏?",
    "–ö–∞–∫–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∞—Ç—Å—è –≤ –ì–û–°–¢ –† 13569-2007 –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –±–∞–Ω–∫–æ–≤?",
    "–ß—Ç–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ì–û–°–¢ –† 18045-2013 –ø–æ –º–µ—Ç–æ–¥–∏–∫–µ –æ—Ü–µ–Ω–∏–≤–∞–Ω–∏—è?",
    "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Ä–µ–≥—É–ª–∏—Ä—É—é—Ç —Å–∏—Å—Ç–µ–º—É –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –≤ –ò–ë?",
    "–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –ì–û–°–¢ –† 19791-2008 –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º –¥–ª—è –¶–û–î?",
    "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¢–ö 362 –∫–∞—Å–∞—é—Ç—Å—è –∫–∞—Ç–µ–≥–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –ö–ò–ò?",
    "–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –ì–û–°–¢ –† 21827-2010 –ø–æ SSE-CMM?",
    "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ–ø–∏—Å—ã–≤–∞—é—Ç –ø—Ä–æ—Ñ–∏–ª—å –∑–∞—â–∏—Ç—ã ¬´–ë–ò¬ª?",
    "–ß—Ç–æ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –ì–û–°–¢ –† 59453.2-2021?",
    "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∫–∞—Å–∞—é—Ç—Å—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å—Ä–µ–¥—Å—Ç–≤ –∑–∞—â–∏—Ç—ã?",
    "–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –ì–û–°–¢ –† 53110-2008 –ø–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É —Å–µ—Ç–µ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏?",
    "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ–ø–∏—Å—ã–≤–∞—é—Ç –æ—Ü–µ–Ω–∫—É —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –°–ó–ò?",
    "–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –ì–û–°–¢ –† 27033-1 –ø–æ —Å–µ—Ç–µ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –ò–ë?",
    "–ö–∞–∫–∏–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ì–û–°–¢ –† 52448?",
    "–ß—Ç–æ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –ì–û–°–¢ –† 59548-2022 –ø–æ –°–ö–ó–ò?",
    "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∏—Ä—É—é—Ç –ø—Ä–æ—Ü–µ—Å—Å—ã –∫–æ–Ω—Ç—Ä–æ–ª—è –∑–∞—â–∏—â–µ–Ω–Ω–æ—Å—Ç–∏?",
    "–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –ì–û–°–¢ –† 54583-2011 –≤ —á–∞—Å—Ç–∏ –¥–æ–≤–µ—Ä–∏—è –∫ –ò–¢-–ø—Ä–æ–¥—É–∫—Ç–∞–º?",
    "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ–ø–∏—Å—ã–≤–∞—é—Ç –æ—Ü–µ–Ω–∫—É —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –ø–æ –ì–û–°–¢ –† 59453?",
    "–ß—Ç–æ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –ì–û–°–¢ –† 59453.4-2025?",
    "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ–ø–∏—Å—ã–≤–∞—é—Ç Common Criteria –∏ CEM?",
    "–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –ì–û–°–¢ –† 58143-2018 –ø–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É CEM?",
    "–ö–∞–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –æ–ø–∏—Å–∞–Ω—ã –≤ –ì–û–°–¢ –† 56546-2015?",
    "–ß—Ç–æ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –ì–û–°–¢ –† 58256-2018 –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –∫–ª—é—á–∞–º–∏?",
    "–ö–∞–∫–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã –¢–ö 362 –∫–∞—Å–∞—é—Ç—Å—è –∏—Å–ø—ã—Ç–∞–Ω–∏–π –°–ó–ò?",
    "–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –ì–û–°–¢ –† 53112-2008 –ø–æ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏?",
    "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ–ø–∏—Å—ã–≤–∞—é—Ç –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç —Å–µ—Ç–µ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏?",
    "–ß—Ç–æ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –ì–û–°–¢ –† 53113.2-2009?",
    "–ö–∞–∫–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∫–∞—Å–∞—é—Ç—Å—è –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–∏ –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏?",
    "–ß—Ç–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ì–û–°–¢ –† 52633.0-2006?",
    "–ö–∞–∫–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –ì–û–°–¢ –† 51275-2006?",
    "–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –ì–û–°–¢ –† 51583-2014 –ø–æ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –°–ó–ò?",
    "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ–ø–∏—Å—ã–≤–∞—é—Ç –∑–∞—â–∏—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞?",
    "–ß—Ç–æ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –ì–û–°–¢ –† 52069.0-2013?",
    "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ–ø–∏—Å—ã–≤–∞—é—Ç Common Criteria TR 15443?",
    "–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –ì–û–°–¢ –† 54581-2011?",
    "–ö–∞–∫–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∞—Ç—Å—è –≤ –ì–û–°–¢ –† 54582-2011?",
    "–ß—Ç–æ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –ì–û–°–¢ –† 54583-2011?",
    "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ–ø–∏—Å—ã–≤–∞—é—Ç –¥–æ–≤–µ—Ä–∏–µ –∫ –ò–¢-–ø—Ä–æ–¥—É–∫—Ç–∞–º –ø–æ –¢–ö 362?",
    "–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –ì–û–°–¢ –† 53109-2008?",
    "–ö–∞–∫–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∫–∞—Å–∞—é—Ç—Å—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∞—É–¥–∏—Ç–∞ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –ò–ë?"
]

TIMES = []
ANSWERS = []  # —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—Å—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

async def run_sync():
    print(f"[üß™] GOST1k Benchmark (Sync Mode) ‚Äî {len(QUERIES)} –∑–∞–ø—Ä–æ—Å–æ–≤\n")

    for i, query in enumerate(QUERIES, 1):
        print(f"\n[{i:03d}] üîç {query}")
        t0 = time.time()
        ans = await answer(query)
        total = time.time() - t0
        TIMES.append(total)
        ANSWERS.append(ans)
        print(f"[‚úÖ] –ò—Ç–æ–≥: {total:.2f} —Å–µ–∫ | {len(ans)} —Å–∏–º–≤–æ–ª–æ–≤")

    # === –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ===
    avg = statistics.mean(TIMES)
    print("\n=== üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ ===")
    print(f"–ó–∞–ø—Ä–æ—Å–æ–≤: {len(QUERIES)}")
    print(f"–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è: {avg:.2f} —Å–µ–∫")
    print(f"–ú–∏–Ω: {min(TIMES):.2f} —Å–µ–∫ | –ú–∞–∫—Å: {max(TIMES):.2f} —Å–µ–∫")
    print(f"–û–±—â–µ–µ –≤—Ä–µ–º—è: {sum(TIMES)/60:.1f} –º–∏–Ω")

    # === –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤ JSON ===
    results = {
        "timestamp": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
        "queries": []
    }

    for i, (q, t, a) in enumerate(zip(QUERIES, TIMES, ANSWERS), 1):
        results["queries"].append({
            "id": i,
            "query": q,
            "time_sec": round(t, 3),
            "answer_preview": a[:300] + ("..." if len(a) > 300 else "")
        })

    results["stats"] = {
        "total_queries": len(QUERIES),
        "avg_time_sec": round(statistics.mean(TIMES), 3),
        "min_time_sec": round(min(TIMES), 3),
        "max_time_sec": round(max(TIMES), 3),
        "total_time_min": round(sum(TIMES) / 60, 2)
    }

    log_path = os.path.join(LOGS, f"eval_results_{datetime.now():%Y%m%d_%H%M%S}.json")
    with open(log_path, "w", encoding="utf-8") as f:
        json.dump(results, f, ensure_ascii=False, indent=2)
    print(f"\n[üíæ] –õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤: {log_path}")

    # === –°–æ—Ö—Ä–∞–Ω—è–µ–º JSONL –¥–ª—è CRAG ===
    crag_path = os.path.join(LOGS, "gost_eval.jsonl")
    with open(crag_path, "w", encoding="utf-8") as f:
        for q, a in zip(QUERIES, ANSWERS):
            # –ï—Å–ª–∏ answer() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç (—Ç–µ–∫—Å—Ç, –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã)
            if isinstance(a, tuple):
                answer_text, retrieved_texts = a
            else:
                answer_text, retrieved_texts = a, []
            item = {
                "query": q,
                "retrieved": "\n".join(retrieved_texts),
                "answer": answer_text.strip()
            }
            f.write(json.dumps(item, ensure_ascii=False) + "\n")
    print(f"[üßæ] –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω —Ñ–∞–π–ª –¥–ª—è CRAG-–æ—Ü–µ–Ω–∫–∏: {crag_path}\n")

    # === CRAG-–æ—Ü–µ–Ω–∫–∞ –ø–æ—Å–ª–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ ===
    
if __name__ == "__main__":
    asyncio.run(run_sync())
    compute_crag_metrics()