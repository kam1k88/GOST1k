# ðŸ§  GOST1k â€” Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ SentenceTransformers Ð´Ð»Ñ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ RAG

**GOST1k** â€” ÑÑ‚Ð¾ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÑ‚ÐµÐº **Retrieval-Augmented Generation (RAG)** Ð´Ð»Ñ Ð¿Ð¾Ð¸ÑÐºÐ° Ð¿Ð¾ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ð¼ **Ð“ÐžÐ¡Ð¢**.  
ÐžÐ½ ÑÐ¾Ñ‡ÐµÑ‚Ð°ÐµÑ‚ Ð½Ð°Ð´Ñ‘Ð¶Ð½Ð¾ÑÑ‚ÑŒ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ð±Ð°Ð·Ñ‹ Ð·Ð½Ð°Ð½Ð¸Ð¹ (**ChromaDB**) Ñ Ð¼Ð¾Ñ‰ÑŒÑŽ ÑÐ¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… ÑÐ·Ñ‹ÐºÐ¾Ð²Ñ‹Ñ… Ð¼Ð¾Ð´ÐµÐ»ÐµÐ¹ (**E5 + BGE + Qwen/Ollama**).

---

## ðŸ“š Ð¦ÐµÐ»ÑŒ

ÐŸÐ¾Ð²Ñ‹ÑÐ¸Ñ‚ÑŒ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¿Ð¾Ð¸ÑÐºÐ° Ð¸ Ð¸Ð½Ð´ÐµÐºÑÐ°Ñ†Ð¸Ð¸ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð², ÑÐ»ÐµÐ´ÑƒÑ Ð¾Ñ„Ð¸Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ð¼ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸ÑÐ¼  
Ñ„Ñ€ÐµÐ¹Ð¼Ð²Ð¾Ñ€ÐºÐ° **SentenceTransformers (SBERT)**.

---
ðŸ“ Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°


GOST1k/
â”œâ”€ docker-compose.yml
â”‚
â”œâ”€ api/
â”‚   â”œâ”€ Dockerfile
â”‚   â””â”€ rag_api.py
â”‚
â”œâ”€ embedder/
â”‚   â”œâ”€ Dockerfile
â”‚   â””â”€ embedder_server.py
â”‚
â”œâ”€ reranker/
â”‚   â”œâ”€ Dockerfile
â”‚   â””â”€ reranker_server.py
â”‚
â”œâ”€ chroma_db/
â”‚   â””â”€ (Ð²ÐµÐºÑ‚Ð¾Ñ€Ð½Ð°Ñ Ð±Ð°Ð·Ð°)
â”‚
â””â”€ docs/
    â””â”€ (Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ Ð´Ð»Ñ Ð¸Ð½Ð´ÐµÐºÑÐ°Ñ†Ð¸Ð¸)


---

## ðŸ§© Ð­Ñ‚Ð°Ð¿ 1. Ð˜Ð½Ð´ÐµÐºÑÐ°Ñ†Ð¸Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² (E5-small)

Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ **bi-encoder** Ð¼Ð¾Ð´ÐµÐ»ÑŒ `intfloat/e5-small`.  
ÐžÐ½Ð° ÐºÐ¾Ð´Ð¸Ñ€ÑƒÐµÑ‚ Ñ‚ÐµÐºÑÑ‚Ñ‹ Ð½ÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾, ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ Ð²ÐµÐºÑ‚Ð¾Ñ€Ð½Ñ‹Ðµ Ð¿Ñ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð¸Ñ.

**ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ð¿Ñ€Ð°ÐºÑ‚Ð¸ÐºÐ¸:**

- **ÐŸÑ€ÐµÑ„Ð¸ÐºÑÑ‹:**
  ```python
  passage_text = "passage: " + segment
  query_text = "query: " + user_query
  ```

- **ÐÐ¾Ñ€Ð¼Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ:**
  ```python
  embeddings = model.encode(texts, normalize_embeddings=True)
  ```

- **Ð Ð°Ð·Ð±Ð¸ÐµÐ½Ð¸Ðµ Ñ‚ÐµÐºÑÑ‚Ð°:**
  > Ð“ÐžÐ¡Ð¢ Ñ€Ð°Ð·Ð±Ð¸Ð²Ð°ÐµÑ‚ÑÑ Ð½Ð° Ñ„Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚Ñ‹ (Ð¿ÑƒÐ½ÐºÑ‚Ñ‹, Ð¿Ð°Ñ€Ð°Ð³Ñ€Ð°Ñ„Ñ‹) Ð½Ðµ Ð´Ð»Ð¸Ð½Ð½ÐµÐµ ~512 Ñ‚Ð¾ÐºÐµÐ½Ð¾Ð².

**ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð·Ð°Ð¿ÑƒÑÐºÐ°:**
```bash
python main.py ingest
```

---

## ðŸ” Ð­Ñ‚Ð°Ð¿ 2. Ð¡ÐµÐ¼Ð°Ð½Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¿Ð¾Ð¸ÑÐº

ÐœÐ¾Ð´ÑƒÐ»ÑŒ `search.py` Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÑ‚ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð¸ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ Ð±Ð»Ð¸Ð·ÐºÐ¸Ðµ Ð¿Ð¾ ÑÐ¼Ñ‹ÑÐ»Ñƒ Ñ„Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚Ñ‹:

```python
query_text = "query: " + user_query
q_emb = model.encode(query_text, normalize_embeddings=True)
results = chroma.query(query_embeddings=q_emb, n_results=10)
```

- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ **Ð°ÑÐ¸Ð¼Ð¼ÐµÑ‚Ñ€Ð¸Ñ‡Ð½Ñ‹Ð¹ Ð¿Ð¾Ð¸ÑÐº** (`query/passage`)
- ÐœÐµÑ‚Ñ€Ð¸ÐºÐ° â€” **ÐºÐ¾ÑÐ¸Ð½ÑƒÑÐ½Ð¾Ðµ ÑÑ…Ð¾Ð´ÑÑ‚Ð²Ð¾**

---

## âš–ï¸ Ð­Ñ‚Ð°Ð¿ 3. Ð ÐµÑ€Ð°Ð½Ð¶Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð² (BGE-reranker-base)

Ð”Ð»Ñ Ð¿Ð¾Ð²Ñ‹ÑˆÐµÐ½Ð¸Ñ Ñ‚Ð¾Ñ‡Ð½Ð¾ÑÑ‚Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ **ÐºÑ€Ð¾ÑÑ-ÑÐ½ÐºÐ¾Ð´ÐµÑ€** `BAAI/bge-reranker-base`.  
ÐžÐ½ Ð¾Ñ†ÐµÐ½Ð¸Ð²Ð°ÐµÑ‚ Ð¿Ð°Ñ€Ñ‹ *(Ð·Ð°Ð¿Ñ€Ð¾Ñ, ÐºÐ°Ð½Ð´Ð¸Ð´Ð°Ñ‚)* Ð¸ ÑÐ¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐµÑ‚ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¿Ð¾ Ñ€ÐµÐ»ÐµÐ²Ð°Ð½Ñ‚Ð½Ð¾ÑÑ‚Ð¸.

```python
from sentence_transformers import CrossEncoder

reranker = CrossEncoder("BAAI/bge-reranker-base")
scores = reranker.predict([(query, passage), ...])
```

- Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð½Ð° ÑÑ‚Ð°Ð¿Ðµ Ð¿Ð¾Ð¸ÑÐºÐ° (Ð½Ðµ Ð¸Ð½Ð´ÐµÐºÑÐ¸Ñ€ÑƒÐµÑ‚ÑÑ)
- ÐÐµ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ Ð¿Ñ€ÐµÑ„Ð¸ÐºÑÐ¾Ð²
- ÐžÐ¿Ñ‚Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð¾: **top-10 â†’ top-3** Ñ„Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ñ… Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²

---

## ðŸš€ Ð­Ñ‚Ð°Ð¿ 4. Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¾Ñ‚Ð²ÐµÑ‚Ð° (LLM)

Ð›ÑƒÑ‡ÑˆÐ¸Ðµ Ñ„Ñ€Ð°Ð³Ð¼ÐµÐ½Ñ‚Ñ‹ Ð¿ÐµÑ€ÐµÐ´Ð°ÑŽÑ‚ÑÑ Ð² **LLM (Ollama / Qwen2.5-7B-Instruct)** Ð´Ð»Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð¸Ñ‚Ð¾Ð³Ð¾Ð²Ð¾Ð³Ð¾ Ð¾Ñ‚Ð²ÐµÑ‚Ð°:

```bash
python main.py search "ÐšÐ°Ðº Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ Ð“ÐžÐ¡Ð¢ Ð  34.11-2012?"
```

Ð’ Ð²ÐµÐ±-Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐµ **Streamlit** Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°ÐµÑ‚ÑÑ Ð¾Ñ‚Ð²ÐµÑ‚ + Ñ†Ð¸Ñ‚Ð°Ñ‚Ñ‹.

---

## ðŸ§® ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ñ

- **ÐŸÐ°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ð¾Ðµ ÐºÐ¾Ð´Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ:**
  ```python
  pool = model.start_multi_process_pool(target_devices=["cuda:0","cuda:1"])
  embeddings = model.encode(texts, pool=pool)
  ```

- **Ð¡Ð¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ñ‹Ðµ Ð²ÐµÑ€ÑÐ¸Ð¸:**
  ```text
  sentence-transformers>=2.2.2,<6.0
  ```

- **Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð¼Ð¾Ð´ÐµÐ»Ð¸:**
  ```
  models/intfloat/e5-small/
  models/BAAI/bge-reranker-base/
  ```

- **ChromaDB:**
  Ð¥Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð²ÐµÐºÑ‚Ð¾Ñ€Ð¾Ð² Ð¸ Ð¿Ð¾Ð¸ÑÐº Ð¿Ð¾ ÐºÐ¾ÑÐ¸Ð½ÑƒÑÐ½Ð¾Ð¼Ñƒ ÑÑ…Ð¾Ð´ÑÑ‚Ð²Ñƒ:
  ```python
  collection.query(query_embeddings=q_emb, n_results=10)
  ```

---

## ðŸ§  ÐŸÐ¾Ð´Ñ‹Ñ‚Ð¾Ð¶Ð¸Ð¼

âœ… Ð˜Ð½Ð´ÐµÐºÑÐ°Ñ†Ð¸Ñ bi-ÑÐ½ÐºÐ¾Ð´ÐµÑ€Ð¾Ð¼ E5 Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð¿Ñ€ÐµÑ„Ð¸ÐºÑÐ°Ð¼Ð¸ Ð¸ Ð½Ð¾Ñ€Ð¼Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸ÐµÐ¹  
âœ… Ð¡ÐµÐ¼Ð°Ð½Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¿Ð¾Ð¸ÑÐº Ð¿Ð¾ ChromaDB  
âœ… Ð ÐµÑ€Ð°Ð½Ð¶Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ BGE CrossEncoder  
âœ… Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ LLM Ð´Ð»Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð¸Ñ‚Ð¾Ð³Ð¾Ð²Ð¾Ð³Ð¾ Ð¾Ñ‚Ð²ÐµÑ‚Ð°  
âœ… ÐŸÐ¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÑ‚ÐµÐº Ð±ÐµÐ· Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ñ‚ Ð¾Ð±Ð»Ð°ÐºÐ¾Ð²  

---

## ðŸ“„ Ð›Ð¸Ñ†ÐµÐ½Ð·Ð¸Ñ

MIT Â© 2025 â€” Ð¿Ñ€Ð¾ÐµÐºÑ‚ **GOST1k**
